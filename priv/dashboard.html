<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="http://www.highcharts.com/js/highstock.js" type="text/javascript"></script>
<script type="text/javascript">

function getUrlVars()
{
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}

var Now = $.now();
var Second = 1000;
var Minute = Second * 60;
var Hour = Minute * 60;
var Day = Hour * 24;
var Month = Day * 30;
var Year = Month * 12;

var Plot;
var SecondPlot;
var MinutePlot;
var HourPlot;

(function($){ // encapsulate jQuery

Plot = function(ChartId, Title, URL, StartTime, Interval) {
	$.getJSON( URL + '?callback=?', function(data) {
		// Create the chart
		window.chart = new Highcharts.StockChart({
			chart : {
				renderTo : 'chart' + ChartId
			},
			title : {
				text : Title
			},			
			series : [{
				dataGrouping : {approximation : "sum"},
				animation: false,
				pointStart: Date.UTC(StartTime.getUTCFullYear(), StartTime.getUTCMonth(), StartTime.getUTCDate(), StartTime.getUTCHours(), StartTime.getUTCMinutes(), StartTime.getUTCSeconds()),
				pointInterval: Interval,
				data : data,
				tooltip: {
					yDecimals: 2
				}
			}]
		});
	})};
}


)(jQuery);

Tag = getUrlVars()["tag"];

SecondPlot = function(ChartId, Title, Host, Port, StartTime, ItemCount, Interval) {
	URL = 'http://' + Host + ':' + Port + '/annalist/second_counts/' + Tag + '/' +
		StartTime.getUTCFullYear() + '/' +
		(StartTime.getUTCMonth() + 1) + '/' +
		StartTime.getUTCDate() + '/' +
		StartTime.getUTCHours() + '/' +
		StartTime.getUTCMinutes() + '/' +
		(StartTime.getUTCSeconds() + 1) + '/' +
		ItemCount;
	Plot(ChartId, Title, URL, StartTime, Interval);
};

MinutePlot = function(ChartId, Title, Host, Port, StartTime, ItemCount, Interval) {
	URL = 'http://' + Host + ':' + Port + '/annalist/minute_counts/' + Tag + '/' +
		StartTime.getUTCFullYear() + '/' +
		(StartTime.getUTCMonth() + 1) + '/' +
		StartTime.getUTCDate() + '/' +
		StartTime.getUTCHours() + '/' +
		StartTime.getUTCMinutes() + '/' +
		ItemCount;
	Plot(ChartId, Title, URL, StartTime, Interval);
};

HourPlot = function(ChartId, Title, Host, Port, StartTime, ItemCount, Interval) {
	URL = 'http://' + Host + ':' + Port + '/annalist/hour_counts/' + Tag + '/' +
		StartTime.getUTCFullYear() + '/' +
		(StartTime.getUTCMonth() + 1) + '/' +
		StartTime.getUTCDate() + '/' +
		StartTime.getUTCHours() + '/' +
		ItemCount;
	Plot(ChartId, Title, URL, StartTime, Interval);
};

if (Tag == undefined) {alert("Please specify a tag in the URL ('...dashboard.html?tag=my_tag')")};
TagsPrint = Tag.replace('%20', '/')

OneHourAgo = new Date($.now() - Hour);
// SecondPlot(1, TagsPrint + " during Last Hour", "localhost", 6060, OneHourAgo, Hour / Second, Second);
OneDayAgo = new Date($.now() - Day);
SecondPlot(2, TagsPrint + " during Last Day", "localhost", 6060, OneDayAgo, Day / Second, Second);
OneMonthAgo = new Date($.now() - Month);
MinutePlot(3, TagsPrint + " during Last Month", "localhost", 6060, OneMonthAgo, Month / Minute, Minute);
OneYearAgo = new Date($.now() - Year);
HourPlot(4, TagsPrint + " during Last Year", "localhost", 6060
	, OneYearAgo, Year / Hour, Hour);

</script>


</script>
</head>
<body>
<!-- <div id="chart1" style="width: 800px; margin-left: 10px; float: left; height: 400px"></div> -->
<div id="chart2" style="width: 800px; margin-left: 10px; float: left; height: 400px"></div>
<div id="chart3" style="width: 800px; margin-left: 10px; float: left; height: 400px"></div>
<div id="chart4" style="width: 800px; margin-left: 10px; float: left; height: 400px"></div>
</html>